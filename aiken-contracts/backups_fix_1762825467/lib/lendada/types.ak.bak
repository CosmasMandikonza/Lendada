use aiken/hash.{Blake2b_224, Hash}
use aiken/transaction/credential.{VerificationKey}
use aiken/transaction/value.{AssetName, PolicyId}

/// Borrower identity with ZK proof verification
pub type IdentityDatum {
  owner: Hash<Blake2b_224, VerificationKey>,
  zk_proof_hash: ByteArray,
  created_at: Int,
  kyc_level: Int,
  country_code: ByteArray,
}

/// Credit score data
pub type CreditScore {
  score: Int,
  total_loans: Int,
  repaid_loans: Int,
  total_borrowed: Int,
  total_repaid: Int,
  last_updated: Int,
}

/// Loan parameters and state
pub type LoanDatum {
  borrower: Hash<Blake2b_224, VerificationKey>,
  lender: Option<Hash<Blake2b_224, VerificationKey>>,
  principal: Int,
  interest_rate: Int,
  duration: Int,
  collateral: Int,
  created_at: Int,
  funded_at: Option<Int>,
  due_at: Int,
  status: LoanStatus,
  identity_nft: (PolicyId, AssetName),
  min_credit_score: Int,
}

/// Loan lifecycle status
pub type LoanStatus {
  Pending
  Funded
  Active
  Repaid
  Defaulted
  Cancelled
}

/// Reputation token metadata
pub type ReputationDatum {
  owner: Hash<Blake2b_224, VerificationKey>,
  reputation_points: Int,
  completed_loans: Int,
  defaults: Int,
  avg_repayment_time: Int,
  last_updated: Int,
}

/// Loan escrow redeemer actions
pub type LoanRedeemer {
  Fund
  Claim
  Repay { amount: Int }
  ClaimDefault
  Cancel
}

/// Identity NFT redeemer
pub type IdentityRedeemer {
  UpdateProof { new_proof_hash: ByteArray }
  UpdateKYC { new_level: Int }
}

/// Reputation token redeemer
pub type ReputationRedeemer {
  UpdateReputation {
    loan_amount: Int,
    repayment_time: Int,
    due_time: Int,
  }
  PenalizeDefault { loan_amount: Int }
}
